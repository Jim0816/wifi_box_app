{"ast":null,"code":"import React, { useRef } from 'react';\nimport classNames from 'classnames';\nimport { withNativeProps } from '../../utils/native-props';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { usePropsValue } from '../../utils/use-props-value';\nimport { Star } from './star';\nimport { useDrag } from '@use-gesture/react';\nimport { bound } from '../../utils/bound';\nconst classPrefix = `adm-rate`;\nconst defaultProps = {\n  count: 5,\n  allowHalf: false,\n  character: React.createElement(Star, null),\n  defaultValue: 0,\n  readOnly: false,\n  allowClear: true\n};\nexport const Rate = p => {\n  const props = mergeProps(defaultProps, p);\n  const [value, setValue] = usePropsValue(props);\n  const containerRef = useRef(null);\n  const starList = Array(props.count).fill(null);\n\n  function renderStar(v, half) {\n    return React.createElement(\"div\", {\n      className: classNames(`${classPrefix}-star`, {\n        [`${classPrefix}-star-active`]: value >= v,\n        [`${classPrefix}-star-half`]: half,\n        [`${classPrefix}-star-readonly`]: props.readOnly\n      }),\n      onClick: () => {\n        if (props.readOnly) return;\n\n        if (props.allowClear && value === v) {\n          setValue(0);\n        } else {\n          setValue(v);\n        }\n      },\n      role: 'radio',\n      \"aria-checked\": value >= v,\n      \"aria-label\": '' + v\n    }, props.character);\n  }\n\n  const bind = useDrag(state => {\n    if (props.readOnly) return;\n    const {\n      xy: [clientX]\n    } = state;\n    const container = containerRef.current;\n    if (!container) return;\n    const rect = container.getBoundingClientRect();\n    const rawValue = (clientX - rect.left) / rect.width * props.count;\n    const roundedValue = props.allowHalf ? Math.round(rawValue * 2) / 2 : Math.round(rawValue);\n    setValue(bound(roundedValue, 0, props.count));\n  }, {\n    axis: 'x',\n    preventScroll: true,\n    pointer: {\n      touch: true\n    }\n  });\n  return withNativeProps(props, React.createElement(\"div\", Object.assign({\n    className: classPrefix,\n    role: 'radiogroup',\n    \"aria-readonly\": props.readOnly,\n    ref: containerRef\n  }, bind()), starList.map((_, i) => React.createElement(\"div\", {\n    key: i,\n    className: classNames(`${classPrefix}-box`)\n  }, props.allowHalf && renderStar(i + 0.5, true), renderStar(i + 1, false)))));\n};","map":{"version":3,"names":["React","useRef","classNames","withNativeProps","mergeProps","usePropsValue","Star","useDrag","bound","classPrefix","defaultProps","count","allowHalf","character","createElement","defaultValue","readOnly","allowClear","Rate","p","props","value","setValue","containerRef","starList","Array","fill","renderStar","v","half","className","onClick","role","bind","state","xy","clientX","container","current","rect","getBoundingClientRect","rawValue","left","width","roundedValue","Math","round","axis","preventScroll","pointer","touch","Object","assign","ref","map","_","i","key"],"sources":["/Users/jim/Tools/git/wifi_box_app/node_modules/antd-mobile/es/components/rate/rate.js"],"sourcesContent":["import React, { useRef } from 'react';\nimport classNames from 'classnames';\nimport { withNativeProps } from '../../utils/native-props';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { usePropsValue } from '../../utils/use-props-value';\nimport { Star } from './star';\nimport { useDrag } from '@use-gesture/react';\nimport { bound } from '../../utils/bound';\nconst classPrefix = `adm-rate`;\nconst defaultProps = {\n  count: 5,\n  allowHalf: false,\n  character: React.createElement(Star, null),\n  defaultValue: 0,\n  readOnly: false,\n  allowClear: true\n};\nexport const Rate = p => {\n  const props = mergeProps(defaultProps, p);\n  const [value, setValue] = usePropsValue(props);\n  const containerRef = useRef(null);\n  const starList = Array(props.count).fill(null);\n\n  function renderStar(v, half) {\n    return React.createElement(\"div\", {\n      className: classNames(`${classPrefix}-star`, {\n        [`${classPrefix}-star-active`]: value >= v,\n        [`${classPrefix}-star-half`]: half,\n        [`${classPrefix}-star-readonly`]: props.readOnly\n      }),\n      onClick: () => {\n        if (props.readOnly) return;\n\n        if (props.allowClear && value === v) {\n          setValue(0);\n        } else {\n          setValue(v);\n        }\n      },\n      role: 'radio',\n      \"aria-checked\": value >= v,\n      \"aria-label\": '' + v\n    }, props.character);\n  }\n\n  const bind = useDrag(state => {\n    if (props.readOnly) return;\n    const {\n      xy: [clientX]\n    } = state;\n    const container = containerRef.current;\n    if (!container) return;\n    const rect = container.getBoundingClientRect();\n    const rawValue = (clientX - rect.left) / rect.width * props.count;\n    const roundedValue = props.allowHalf ? Math.round(rawValue * 2) / 2 : Math.round(rawValue);\n    setValue(bound(roundedValue, 0, props.count));\n  }, {\n    axis: 'x',\n    preventScroll: true,\n    pointer: {\n      touch: true\n    }\n  });\n  return withNativeProps(props, React.createElement(\"div\", Object.assign({\n    className: classPrefix,\n    role: 'radiogroup',\n    \"aria-readonly\": props.readOnly,\n    ref: containerRef\n  }, bind()), starList.map((_, i) => React.createElement(\"div\", {\n    key: i,\n    className: classNames(`${classPrefix}-box`)\n  }, props.allowHalf && renderStar(i + 0.5, true), renderStar(i + 1, false)))));\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}